module.exports=function(server,option)
{
	var io=require("socket.io");if (!io) throw "socket.io is not found";
	return  createIO(io(server,option));
}
module.exports.listen=function(app)
{
	var io=require("socket.io");if (!io) throw "socket.io is not found";
	return  createIO(io.listen(app));

}
function createIO(io)
{
	var res={};
	res._io=io;
	res.on=function(msg,func)
	{
		return res._io.on(msg,function (socket)
		{
			return func(createSocket(socket));
		});
	};
	res.emit=function(msg,json,func){return res._io.emit(msg,json,func);}
	res.of=function(str){return createIO(res._io.of(str));}
	for (var i in io) if (!res[i])
	{		
		res[i]=new Function('this._io["'+i+'"].apply(this._io,arguments);');		
	}
	return res;
}
function createSocket(socket,notgodeeper)
{	
	var res={_socket:socket};	
	if (res._socket.broadcast && !notgodeeper) res.broadcast= createSocket(res._socket.broadcast,true);
	res.all={
				emit:function(msg,data)
				{
					res._socket.emit(msg,data);
					res._socket.broadcast.emit(msg,data);
				}
			}
	for (var i in socket) if (!res[i])
	{		
		res[i]=new Function('this._socket["'+i+'"].apply(this._socket,arguments);');		
	}
	return res;
}